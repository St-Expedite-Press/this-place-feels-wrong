{
  "deploy": {
    "cloudflare_worker": {
      "dir": "workers/communications/",
      "routes_expected": [
        "stexpedite.press/api/*"
      ],
      "workers_dev_url": "https://stexpedite-communications.stexpedite-communications.workers.dev"
    },
    "github_pages": {
      "artifact_dir": "dist/",
      "custom_domain_file": "site/CNAME",
      "health_monitor_workflow": ".github/workflows/api-health-monitor.yml",
      "published_dir": "site/",
      "workflow": ".github/workflows/deploy-pages.yml"
    }
  },
  "docs": {
    "agent_protocols": "AGENTS.md",
    "deployment": "DEPLOYMENT.md",
    "d1_database": "docs/infrastructure/d1-database.md",
    "email_pipeline": "docs/infrastructure/email-worker-setup.md",
    "incident_runbook": "docs/operations/incident-runbook.md",
    "ontology": "docs/ontology/project-ontology.json",
    "release_ops_log": "docs/operations/release-ops-log.md",
    "skills_taxonomy": "skills/README.md",
    "state_of_play": "docs/state-of-play.md",
    "workers_openapi": "workers/communications/openapi.yaml"
  },
  "domains": {
    "edge": "Cloudflare (proxied)",
    "nameservers": [
      "nicolas.ns.cloudflare.com",
      "sara.ns.cloudflare.com"
    ],
    "newsletters": {
      "substack": "ecoamericana.substack.com"
    },
    "mail_inbound_provider": "Zoho",
    "origin": "GitHub Pages",
    "primary": "stexpedite.press"
  },
  "generated_at": "2026-02-23",
  "generated_from_commit": "1c47708",
  "ontology_version": "1",
  "intents": {
    "edit_contact_form": {
      "touch": [
        "site/contact.html"
      ],
      "related": [
        "workers/communications/src/index.ts"
      ],
      "notes": [
        "Contact form JS is inline in site/contact.html; look for fetch('/api/contact')",
        "Honeypot field is website (see worker pickHoneypot)."
      ],
      "also_update_if_contract_changes": [
        "docs/ontology/project-ontology.json",
        "docs/ontology/project-ontology.md",
        "docs/state-of-play.md"
      ]
    },
    "edit_submission_form": {
      "touch": [
        "site/submit.html"
      ],
      "related": [
        "workers/communications/src/index.ts"
      ],
      "notes": [
        "Submission form JS is inline in site/submit.html; look for fetch('/api/submit')."
      ]
    },
    "edit_updates_signup": {
      "touch": [
        "site/index.html",
        "site/contact.html"
      ],
      "related": [
        "workers/communications/src/index.ts",
        "workers/communications/migrations/0001_updates_signups.sql",
        "workers/communications/wrangler.toml"
      ],
      "notes": [
        "Index has two updates forms wired by wireUpdatesForm() (index + hero bar).",
        "Updates capture posts to /api/updates first, then prompts users to optionally continue to Substack."
      ]
    },
    "edit_global_nav_or_footer_links": {
      "touch": [
        "site/index.html",
        "site/books.html",
        "site/gallery.html",
        "site/mission.html",
        "site/contact.html",
        "site/submit.html",
        "site/lab.html",
        "site/services.html"
      ],
      "notes": [
        "Nav markup is duplicated across pages; see site.duplication_clusters.nav.",
        "Lab is intentionally pointed at under-construction.html in several places (see docs/state-of-play.md)."
      ]
    },
    "add_or_change_worker_endpoint": {
      "touch": [
        "workers/communications/src/index.ts",
        "workers/communications/wrangler.toml"
      ],
      "also_update": [
        "docs/ontology/project-ontology.json",
        "docs/ontology/project-ontology.md",
        "docs/state-of-play.md"
      ]
    },
    "change_github_pages_deploy": {
      "touch": [
        ".github/workflows/deploy-pages.yml"
      ],
      "also_review": [
        "docs/state-of-play.md",
        "DEPLOYMENT.md",
        "AGENTS.md"
      ]
    }
  },
  "files": {
    "site/index.html": {
      "role": "Portal page; contains two updates forms (desktop hero bar + mobile portal stack)",
      "anchors": {
        "desktop_updates_form": "<form class=\"hero-bar__updates\" id=\"hero-updates-form\">",
        "mobile_updates_form": "<form class=\"thin-form\" id=\"index-updates-form\">",
        "updates_wiring": "function wireUpdatesForm(opts)",
        "updates_capture": "fetch('/api/updates'",
        "primary_nav_desktop": "<nav class=\"big-nav\"",
        "splash_footer_links": "<div class=\"splash__foot\">"
      }
    },
    "site/contact.html": {
      "role": "Contact page; contact form + updates widget; both implemented with inline JS",
      "anchors": {
        "header_nav": "<nav class=\"header-nav\">",
        "contact_form": "<form class=\"contact-form\" id=\"contact-form\"",
        "honeypot": "id=\"website\"",
        "contact_fetch": "fetch('/api/contact'",
        "updates_widget": "id=\"contact-updates-email\"",
        "updates_fetch": "fetch('/api/updates'",
        "mailto_fallback": "mailto:editor@stexpedite.press"
      }
    },
    "site/submit.html": {
      "role": "Submission inquiry page; implemented with inline JS",
      "anchors": {
        "header_nav": "<nav class=\"nav\">",
        "submit_form": "<form class=\"form\" id=\"submit-form\">",
        "honeypot": "id=\"submit-website\"",
        "submit_fetch": "fetch('/api/submit'",
        "mailto_fallback": "mailto:editor@stexpedite.press"
      }
    },
    "workers/communications/src/index.ts": {
      "role": "Cloudflare Worker implementing /api/health, /api/storefront, /api/contact, /api/submit, /api/updates with rate limiting, optional Turnstile, and structured 500 handling",
      "anchors": {
        "cors": "function withCors",
        "rate_limit": "function checkRateLimit",
        "turnstile": "async function verifyTurnstile",
        "email_validation": "function isProbablyEmail",
        "ref_id": "function refId",
        "honeypot": "function pickHoneypot",
        "health_route": "if (url.pathname === \"/api/health\" && request.method === \"GET\")",
        "storefront_route": "if (url.pathname === \"/api/storefront\" && request.method === \"GET\")",
        "updates_route": "if (url.pathname === \"/api/updates\")",
        "contact_route": "if (url.pathname === \"/api/contact\")",
        "submit_route": "if (url.pathname === \"/api/submit\")"
      }
    },
    ".github/workflows/deploy-pages.yml": {
      "role": "GitHub Pages pipeline: validates HTML, runs communications Worker tests, then rsync site/ -> dist/ for artifact",
      "anchors": {
        "htmlhint": "npx -y htmlhint \"site/**/*.html\"",
        "worker_tests": "npm --prefix workers/communications run test",
        "artifact_prep": "rsync -a --delete site/ dist/"
      }
    },
    ".github/workflows/api-health-monitor.yml": {
      "role": "Scheduled production runtime probe for /api/health and synthetic POST route checks (15-minute cadence)",
      "anchors": {
        "schedule": "cron: \"*/15 * * * *\"",
        "health_probe": "curl -fsS https://stexpedite.press/api/health",
        "storefront_probe": "https://stexpedite.press/api/storefront",
        "updates_probe": "-X POST https://stexpedite.press/api/updates",
        "contact_probe": "-X POST https://stexpedite.press/api/contact",
        "submit_probe": "-X POST https://stexpedite.press/api/submit"
      }
    },
    "workers/communications/openapi.yaml": {
      "role": "Machine-readable API contract for /api/health, /api/storefront, /api/contact, /api/submit, /api/updates",
      "anchors": {
        "openapi_version": "openapi: 3.1.0",
        "health_path": "/api/health:",
        "storefront_path": "/api/storefront:",
        "contact_path": "/api/contact:",
        "submit_path": "/api/submit:",
        "updates_path": "/api/updates:"
      }
    }
  },
  "invariants": [
    {
      "id": "pages_publishes_site_only",
      "rule": "GitHub Pages publishes site/ only (copied into dist/ artifact)",
      "source": ".github/workflows/deploy-pages.yml"
    },
    {
      "id": "urls_flat_root",
      "rule": "Even though files live under site/, public URLs resolve at domain root (e.g. /contact.html, /assets/...)",
      "source": "docs/state-of-play.md"
    },
    {
      "id": "no_secrets_committed",
      "rule": "Never commit secrets; .env is local-only; Worker secrets belong in Cloudflare",
      "source": "AGENTS.md"
    },
    {
      "id": "worker_routes_require_proxied_dns",
      "rule": "Cloudflare Worker routes only apply when hostnames are proxied (orange cloud)",
      "source": "docs/state-of-play.md"
    }
  ],
  "maintenance": {
    "when_changing_site_pages_or_assets": [
      "docs/ontology/project-ontology.json",
      "docs/state-of-play.md"
    ],
    "when_changing_worker_routes_or_contracts": [
      "docs/ontology/project-ontology.json",
      "docs/ontology/project-ontology.md",
      "docs/state-of-play.md",
      "docs/infrastructure/d1-database.md",
      "docs/operations/incident-runbook.md",
      "workers/communications/openapi.yaml"
    ],
    "when_changing_deploy_pipeline": [
      "docs/ontology/project-ontology.json",
      "docs/state-of-play.md",
      "DEPLOYMENT.md"
    ]
  },
  "smoke_tests": {
    "github_pages": {
      "validate_html": "npx -y htmlhint \"site/**/*.html\""
    },
    "worker_endpoints": {
      "notes": [
        "Use a local dev Worker (wrangler dev) or a deployed preview. Do not paste real API keys into logs.",
        "Worker exposes GET /api/health and POST endpoints for contact/submit/updates; responds to OPTIONS for CORS preflight."
      ],
      "production_base": "https://stexpedite.press",
      "health": {
        "curl": "curl -i https://stexpedite.press/api/health",
        "expected": "200 { ok:true, service:'communications-worker', dbConfigured:boolean, now:ISO-8601 }"
      },
      "contact": {
        "curl": "curl -i -X POST http://127.0.0.1:8787/api/contact -H \"content-type: application/json\" --data '{\"reason\":\"General\",\"email\":\"test@example.com\",\"message\":\"Hello\",\"website\":\"\"}'",
        "powershell_prod": "Invoke-RestMethod -Method POST -Uri \"https://stexpedite.press/api/contact\" -ContentType \"application/json\" -Body '{\"reason\":\"Test\",\"email\":\"test@example.com\",\"message\":\"Hello\"}'"
      },
      "submit": {
        "curl": "curl -i -X POST http://127.0.0.1:8787/api/submit -H \"content-type: application/json\" --data '{\"email\":\"test@example.com\",\"note\":\"Hi\",\"website\":\"\"}'"
      },
      "updates": {
        "curl": "curl -i -X POST http://127.0.0.1:8787/api/updates -H \"content-type: application/json\" --data '{\"email\":\"test@example.com\",\"source\":\"index\",\"website\":\"\"}'",
        "expected_when_no_d1": "500 { ok:false, error: 'Updates list not configured' }"
      }
    }
  },
  "site": {
    "assets": {
      "assets/css/a11y.css": {
        "bytes": 760,
        "role": "Skip link + focus-visible defaults"
      },
      "assets/css/base.css": {
        "bytes": 2030,
        "role": "Theme tokens + background image-set (mobile tuned)"
      },
      "assets/css/content-shell.css": {
        "bytes": 3704,
        "role": "Shared interior page shell (header/nav/cards)"
      },
      "assets/css/effects.css": {
        "bytes": 859,
        "role": "Grain + cursor glow visuals"
      },
      "assets/css/footer.css": {
        "bytes": 1616,
        "role": "Shared footer"
      },
      "assets/css/hero-bar.css": {
        "bytes": 4139,
        "role": "Top social hero bar + desktop updates form"
      },
      "assets/gif/crow_glitch_text.gif": {
        "bytes": 2513938,
        "role": "Portal media animation (primary GIF)"
      },
      "assets/img/crow_glitch_text.webp": {
        "bytes": 838278,
        "role": "Portal media animation (optional WebP fallback)"
      },
      "assets/img/crow_glitch_text_still.webp": {
        "bytes": 122370,
        "role": "Portal still image (optional WebP fallback)"
      },
      "assets/img/crow_glitch_text_still.png": {
        "bytes": 1243283,
        "role": "Portal still image (primary PNG)"
      },
      "assets/img/favicon.svg": {
        "bytes": 338,
        "role": "Favicon"
      },
      "assets/img/les-fievres-cover.svg": {
        "bytes": 708827,
        "role": "Book cover (SVG)"
      },
      "assets/img/void_engine_twinkle_green.png": {
        "bytes": 2094346,
        "role": "Background texture (primary)"
      },
      "assets/img/void_engine_twinkle_green.webp": {
        "bytes": 143826,
        "role": "Background texture (optional WebP fallback)"
      },
      "assets/js/cursor-glow.js": {
        "bytes": 736,
        "role": "Interior pages pointer glow"
      },
      "assets/js/index-effects.js": {
        "bytes": 1441,
        "role": "Index-only pointer effects (portal warp + glow)"
      },
      "assets/js/modal-utils.js": {
        "bytes": 1918,
        "role": "Modal helpers (Books/Merch)"
      }
    },
    "asset_bundles": {
      "portal": {
        "css": [
          "assets/css/base.css",
          "assets/css/effects.css",
          "assets/css/a11y.css",
          "assets/css/hero-bar.css",
          "assets/css/footer.css"
        ],
        "js": [
          "assets/js/index-effects.js"
        ],
        "pages": [
          "site/index.html"
        ]
      },
      "interior_shell": {
        "css": [
          "assets/css/base.css",
          "assets/css/effects.css",
          "assets/css/a11y.css",
          "assets/css/content-shell.css",
          "assets/css/hero-bar.css",
          "assets/css/footer.css"
        ],
        "js": [
          "assets/js/cursor-glow.js"
        ],
        "pages": [
          "site/books.html",
          "site/gallery.html",
          "site/mission.html",
          "site/contact.html",
          "site/services.html"
        ]
      },
      "forms_inline_js": {
        "pages": [
          "site/contact.html",
          "site/submit.html"
        ],
        "notes": [
          "These pages implement fetch() calls with inline scripts rather than site/assets/js/*.js modules."
        ]
      }
    },
    "duplication_clusters": {
      "nav": {
        "header_nav_pages": [
          "site/books.html",
          "site/gallery.html",
          "site/mission.html",
          "site/contact.html",
          "site/lab.html",
          "site/services.html",
          "site/interior-content-template.html"
        ],
        "alt_nav_pages": [
          "site/submit.html"
        ],
        "portal_nav_pages": [
          "site/index.html"
        ]
      },
      "footer_links": {
        "pages": [
          "site/index.html",
          "site/books.html",
          "site/gallery.html",
          "site/mission.html",
          "site/contact.html",
          "site/submit.html",
          "site/lab.html",
          "site/services.html"
        ],
        "notes": [
          "Most pages include a footer link row containing Services/Submission/Contact."
        ]
      }
    },
    "pages": {
      "books.html": {
        "path": "site/books.html",
        "external_domains": [
          "ecoamericana.substack.com",
          "fonts.googleapis.com",
          "fonts.gstatic.com",
          "github.com",
          "t.me",
          "x.com"
        ],
        "local_refs": [
          "...",
          "assets/css/a11y.css",
          "assets/css/base.css",
          "assets/css/content-shell.css",
          "assets/css/effects.css",
          "assets/css/footer.css",
          "assets/css/hero-bar.css",
          "assets/img/favicon.svg",
          "assets/img/les-fievres-cover.svg",
          "assets/js/cursor-glow.js",
          "assets/js/modal-utils.js",
          "books.html",
          "contact.html",
          "gallery.html",
          "index.html",
          "mission.html",
          "submit.html",
          "under-construction.html"
        ],
        "deps": {
          "css": [
            "assets/css/a11y.css",
            "assets/css/base.css",
            "assets/css/content-shell.css",
            "assets/css/effects.css",
            "assets/css/footer.css",
            "assets/css/hero-bar.css"
          ],
          "js": [
            "assets/js/cursor-glow.js",
            "assets/js/modal-utils.js"
          ],
          "img": [
            "assets/img/favicon.svg",
            "assets/img/les-fievres-cover.svg"
          ],
          "pages": [
            "books.html",
            "contact.html",
            "gallery.html",
            "index.html",
            "mission.html",
            "submit.html",
            "under-construction.html"
          ],
          "misc": [
            "..."
          ],
          "endpoints": []
        }
      },
      "contact.html": {
        "path": "site/contact.html",
        "external_domains": [
          "ecoamericana.substack.com",
          "fonts.googleapis.com",
          "fonts.gstatic.com",
          "github.com",
          "t.me",
          "x.com"
        ],
        "local_refs": [
          "assets/css/a11y.css",
          "assets/css/base.css",
          "assets/css/content-shell.css",
          "assets/css/effects.css",
          "assets/css/footer.css",
          "assets/css/hero-bar.css",
          "assets/img/favicon.svg",
          "assets/js/cursor-glow.js",
          "books.html",
          "contact.html",
          "gallery.html",
          "index.html",
          "mission.html",
          "submit.html",
          "under-construction.html"
        ],
        "deps": {
          "css": [
            "assets/css/a11y.css",
            "assets/css/base.css",
            "assets/css/content-shell.css",
            "assets/css/effects.css",
            "assets/css/footer.css",
            "assets/css/hero-bar.css"
          ],
          "js": [
            "assets/js/cursor-glow.js"
          ],
          "img": [
            "assets/img/favicon.svg"
          ],
          "pages": [
            "books.html",
            "contact.html",
            "gallery.html",
            "index.html",
            "mission.html",
            "submit.html",
            "under-construction.html"
          ],
          "misc": [],
          "endpoints": [
            "/api/contact",
            "/api/updates"
          ]
        }
      },
      "gallery.html": {
        "path": "site/gallery.html",
        "external_domains": [
          "ecoamericana.substack.com",
          "fonts.googleapis.com",
          "fonts.gstatic.com",
          "github.com",
          "t.me",
          "x.com"
        ],
        "local_refs": [
          "${buyUrl}",
          "assets/css/a11y.css",
          "assets/css/base.css",
          "assets/css/content-shell.css",
          "assets/css/effects.css",
          "assets/css/footer.css",
          "assets/css/hero-bar.css",
          "assets/img/favicon.svg",
          "assets/js/cursor-glow.js",
          "assets/js/modal-utils.js",
          "books.html",
          "contact.html",
          "gallery.html",
          "index.html",
          "mission.html",
          "submit.html",
          "under-construction.html"
        ],
        "deps": {
          "css": [
            "assets/css/a11y.css",
            "assets/css/base.css",
            "assets/css/content-shell.css",
            "assets/css/effects.css",
            "assets/css/footer.css",
            "assets/css/hero-bar.css"
          ],
          "js": [
            "assets/js/cursor-glow.js",
            "assets/js/modal-utils.js"
          ],
          "img": [
            "assets/img/favicon.svg"
          ],
          "pages": [
            "books.html",
            "contact.html",
            "gallery.html",
            "index.html",
            "mission.html",
            "submit.html",
            "under-construction.html"
          ],
          "misc": [
            "${buyUrl}"
          ],
          "endpoints": []
        }
      },
      "index.html": {
        "path": "site/index.html",
        "external_domains": [
          "ecoamericana.substack.com",
          "fonts.googleapis.com",
          "fonts.gstatic.com",
          "github.com",
          "t.me",
          "x.com"
        ],
        "local_refs": [
          "assets/css/a11y.css",
          "assets/css/base.css",
          "assets/css/effects.css",
          "assets/css/footer.css",
          "assets/css/hero-bar.css",
          "assets/gif/crow_glitch_text.gif",
          "assets/img/crow_glitch_text_still.png",
          "assets/img/favicon.svg",
          "assets/js/index-effects.js",
          "books.html",
          "contact.html",
          "gallery.html",
          "mission.html",
          "submit.html",
          "under-construction.html"
        ],
        "deps": {
          "css": [
            "assets/css/a11y.css",
            "assets/css/base.css",
            "assets/css/effects.css",
            "assets/css/footer.css",
            "assets/css/hero-bar.css"
          ],
          "js": [
            "assets/js/index-effects.js"
          ],
          "img": [
            "assets/gif/crow_glitch_text.gif",
            "assets/img/crow_glitch_text_still.png",
            "assets/img/favicon.svg"
          ],
          "pages": [
            "books.html",
            "contact.html",
            "gallery.html",
            "mission.html",
            "submit.html",
            "under-construction.html"
          ],
          "misc": [],
          "endpoints": [
            "/api/updates"
          ]
        }
      },
      "interior-content-template.html": {
        "path": "site/interior-content-template.html",
        "external_domains": [
          "ecoamericana.substack.com",
          "fonts.googleapis.com",
          "fonts.gstatic.com",
          "github.com",
          "t.me",
          "x.com"
        ],
        "local_refs": [
          "assets/css/hero-bar.css",
          "assets/img/favicon.svg",
          "books.html",
          "gallery.html",
          "index.html",
          "mission.html",
          "under-construction.html"
        ],
        "deps": {
          "css": [
            "assets/css/hero-bar.css"
          ],
          "js": [],
          "img": [
            "assets/img/favicon.svg"
          ],
          "pages": [
            "books.html",
            "gallery.html",
            "index.html",
            "mission.html",
            "under-construction.html"
          ],
          "misc": [],
          "endpoints": []
        }
      },
      "lab.html": {
        "path": "site/lab.html",
        "external_domains": [
          "fonts.googleapis.com",
          "fonts.gstatic.com",
          "www.w3.org"
        ],
        "local_refs": [
          "assets/css/footer.css",
          "assets/css/hero-bar.css",
          "assets/img/favicon.svg",
          "books.html",
          "contact.html",
          "gallery.html",
          "index.html",
          "mission.html",
          "submit.html",
          "under-construction.html"
        ],
        "deps": {
          "css": [
            "assets/css/footer.css",
            "assets/css/hero-bar.css"
          ],
          "js": [],
          "img": [
            "assets/img/favicon.svg"
          ],
          "pages": [
            "books.html",
            "contact.html",
            "gallery.html",
            "index.html",
            "mission.html",
            "submit.html",
            "under-construction.html"
          ],
          "misc": [],
          "endpoints": []
        }
      },
      "mission.html": {
        "path": "site/mission.html",
        "external_domains": [
          "ecoamericana.substack.com",
          "fonts.googleapis.com",
          "fonts.gstatic.com",
          "github.com",
          "t.me",
          "x.com"
        ],
        "local_refs": [
          "assets/css/a11y.css",
          "assets/css/base.css",
          "assets/css/content-shell.css",
          "assets/css/effects.css",
          "assets/css/footer.css",
          "assets/css/hero-bar.css",
          "assets/img/favicon.svg",
          "assets/js/cursor-glow.js",
          "books.html",
          "contact.html",
          "gallery.html",
          "index.html",
          "mission.html",
          "submit.html",
          "under-construction.html"
        ],
        "deps": {
          "css": [
            "assets/css/a11y.css",
            "assets/css/base.css",
            "assets/css/content-shell.css",
            "assets/css/effects.css",
            "assets/css/footer.css",
            "assets/css/hero-bar.css"
          ],
          "js": [
            "assets/js/cursor-glow.js"
          ],
          "img": [
            "assets/img/favicon.svg"
          ],
          "pages": [
            "books.html",
            "contact.html",
            "gallery.html",
            "index.html",
            "mission.html",
            "submit.html",
            "under-construction.html"
          ],
          "misc": [],
          "endpoints": []
        }
      },
      "services.html": {
        "path": "site/services.html",
        "external_domains": [
          "ecoamericana.substack.com",
          "fonts.googleapis.com",
          "fonts.gstatic.com",
          "github.com",
          "t.me",
          "x.com"
        ],
        "local_refs": [
          "assets/css/a11y.css",
          "assets/css/base.css",
          "assets/css/content-shell.css",
          "assets/css/effects.css",
          "assets/css/footer.css",
          "assets/css/hero-bar.css",
          "assets/img/favicon.svg",
          "assets/js/cursor-glow.js",
          "books.html",
          "contact.html",
          "gallery.html",
          "index.html",
          "mission.html",
          "submit.html",
          "under-construction.html"
        ],
        "deps": {
          "css": [
            "assets/css/a11y.css",
            "assets/css/base.css",
            "assets/css/content-shell.css",
            "assets/css/effects.css",
            "assets/css/footer.css",
            "assets/css/hero-bar.css"
          ],
          "js": [
            "assets/js/cursor-glow.js"
          ],
          "img": [
            "assets/img/favicon.svg"
          ],
          "pages": [
            "books.html",
            "contact.html",
            "gallery.html",
            "index.html",
            "mission.html",
            "submit.html",
            "under-construction.html"
          ],
          "misc": [],
          "endpoints": []
        }
      },
      "submit.html": {
        "path": "site/submit.html",
        "external_domains": [
          "ecoamericana.substack.com",
          "fonts.googleapis.com",
          "fonts.gstatic.com",
          "github.com",
          "t.me",
          "x.com"
        ],
        "local_refs": [
          "assets/css/footer.css",
          "assets/css/hero-bar.css",
          "assets/img/favicon.svg",
          "books.html",
          "contact.html",
          "gallery.html",
          "index.html",
          "mission.html",
          "submit.html",
          "under-construction.html"
        ],
        "deps": {
          "css": [
            "assets/css/footer.css",
            "assets/css/hero-bar.css"
          ],
          "js": [],
          "img": [
            "assets/img/favicon.svg"
          ],
          "pages": [
            "books.html",
            "contact.html",
            "gallery.html",
            "index.html",
            "mission.html",
            "submit.html",
            "under-construction.html"
          ],
          "misc": [],
          "endpoints": [
            "/api/submit"
          ]
        }
      },
      "under-construction.html": {
        "path": "site/under-construction.html",
        "external_domains": [
          "ecoamericana.substack.com",
          "fonts.googleapis.com",
          "fonts.gstatic.com",
          "github.com",
          "t.me",
          "x.com"
        ],
        "local_refs": [
          "assets/css/hero-bar.css",
          "assets/img/favicon.svg",
          "index.html"
        ],
        "deps": {
          "css": [
            "assets/css/hero-bar.css"
          ],
          "js": [],
          "img": [
            "assets/img/favicon.svg"
          ],
          "pages": [
            "index.html"
          ],
          "misc": [],
          "endpoints": []
        }
      }
    },
    "root": "site/",
    "seo": {
      "canonical_base_url": "https://stexpedite.press",
      "disallow_paths": [
        "/under-construction.html",
        "/interior-content-template.html"
      ],
      "robots": "site/robots.txt",
      "sitemap": "site/sitemap.xml"
    },
    "flows": {
      "contact_message": {
        "page": "site/contact.html",
        "endpoint": "/api/contact",
        "fallback": "mailto:editor@stexpedite.press",
        "provider": "Resend (via Worker)",
        "frontend": {
          "form_id": "contact-form",
          "fields": {
            "reason": "#reason",
            "email": "#email",
            "message": "#message",
            "honeypot": "#website"
          },
          "helper": {
            "container": "#contact-helper",
            "text": "#contact-helper-text",
            "mailto": "#contact-mailto-fallback",
            "copy": "#contact-copy"
          },
          "fetch": {
            "url": "/api/contact",
            "method": "POST",
            "content_type": "application/json"
          }
        }
      },
      "submission_inquiry": {
        "page": "site/submit.html",
        "endpoint": "/api/submit",
        "fallback": "mailto:editor@stexpedite.press",
        "provider": "Resend (via Worker)",
        "frontend": {
          "form_id": "submit-form",
          "fields": {
            "email": "#submit-email",
            "note": "#submit-note",
            "honeypot": "#submit-website"
          },
          "helper": {
            "container": "#submit-helper",
            "text": "#submit-helper-text",
            "mailto": "#submit-mailto-fallback",
            "copy": "#submit-copy"
          },
          "fetch": {
            "url": "/api/submit",
            "method": "POST",
            "content_type": "application/json"
          }
        }
      },
      "updates_signup": {
        "pages": [
          "site/index.html",
          "site/contact.html"
        ],
        "index_placement": {
          "desktop": "hero bar (left)",
          "mobile": "portal stack"
        },
        "external_newsletter": "ecoamericana.substack.com",
        "first_party_capture_endpoint": "/api/updates",
        "storage": "Cloudflare D1 (optional; binding DB)",
        "frontend": {
          "index": {
            "forms": [
              {
                "form_id": "index-updates-form",
                "email": "#index-updates-email",
                "helper": "#index-updates-helper",
                "helper_text": "#index-updates-helper-text",
                "open": "#index-updates-open",
                "copy": "#index-updates-copy",
                "source": "index"
              },
              {
                "form_id": "hero-updates-form",
                "email": "#hero-updates-email",
                "helper": "#hero-updates-helper",
                "helper_text": "#hero-updates-helper-text",
                "open": "#hero-updates-open",
                "copy": "#hero-updates-copy",
                "source": "hero-bar"
              }
            ]
          },
          "contact": {
            "email": "#contact-updates-email",
            "submit": "#contact-updates-submit",
            "helper": "#contact-updates-helper",
            "helper_text": "#contact-updates-helper-text",
            "open": "#contact-updates-open",
            "copy": "#contact-updates-copy",
            "source": "contact"
          }
        }
      }
    },
    "dependency_structure": {
      "static_publish": {
        "published_dir": "site/",
        "published_at": "/",
        "workflow": ".github/workflows/deploy-pages.yml"
      },
      "edge_routing": {
        "cloudflare": "proxies site hostnames; routes /api/* to Worker",
        "worker_route_expected": [
          "stexpedite.press/api/*"
        ],
        "worker_direct_url": "https://stexpedite-communications.stexpedite-communications.workers.dev"
      },
      "key_files": {
        "entrypoint": "site/index.html",
        "shared_css": [
          "site/assets/css/base.css",
          "site/assets/css/hero-bar.css",
          "site/assets/css/effects.css",
          "site/assets/css/a11y.css",
          "site/assets/css/footer.css"
        ],
        "worker_entry": "workers/communications/src/index.ts"
      }
    }
  },
  "workers": {
    "communications": {
      "openapi": "workers/communications/openapi.yaml",
      "bindings": {
        "d1_optional": {
          "binding": "DB",
          "migration": "workers/communications/migrations/0001_updates_signups.sql"
        },
        "secrets": [
          "RESEND_API_KEY"
        ],
        "vars": [
          "FROM_EMAIL",
          "TO_EMAIL"
        ]
      },
      "cors_allowed_origins": [
        "https://stexpedite.press",
        "http://localhost:8787",
        "http://127.0.0.1:8787"
      ],
      "data": {
        "updates_signups": {
          "primary_key": "email",
          "table": "updates_signups",
          "unsubscribed_at": "nullable timestamp; non-null means opted out"
        }
      },
      "entry": "workers/communications/src/index.ts",
      "production_integration": {
        "route_active": "stexpedite.press/api/*",
        "mail_inbound": "Zoho",
        "mail_outbound": "Resend",
        "dns_auth": {
          "spf": "v=spf1 include:zohomail.com include:dc-8e814c8572._spfm.stexpedite.press include:amazonses.com include:_spf.zoho.com ~all",
          "dmarc": "v=DMARC1; p=quarantine;",
          "dkim_selectors": [
            "zmail._domainkey",
            "resend._domainkey"
          ],
          "mx_hosts": [
            "mx.zoho.com",
            "mx2.zoho.com",
            "mx3.zoho.com"
          ]
        }
      },
      "routes": {
        "/api/health": {
          "method": "GET",
          "purpose": "Runtime health probe for Worker availability and DB binding visibility",
          "response": {
            "success": {
              "status": 200,
              "body": {
                "ok": true,
                "service": "communications-worker",
                "dbConfigured": true,
                "now": "ISO-8601"
              }
            }
          }
        },
        "/api/storefront": {
          "method": "GET",
          "purpose": "Expose normalized Fourthwall storefront catalog data to gallery UI",
          "requires": [
            "FOURTH_WALL_API_KEY or FW_STOREFRONT_TOKEN"
          ],
          "request": {
            "query": {
              "collection": {
                "type": "string",
                "required": false
              }
            }
          },
          "response": {
            "success": {
              "status": 200,
              "body": {
                "ok": true,
                "shop": {
                  "id": "<shop-id>",
                  "name": "St. Expedite Press",
                  "domain": "shop.stexpedite.press",
                  "url": "https://shop.stexpedite.press"
                },
                "collection": "all",
                "collections": [],
                "products": []
              }
            }
          },
          "errors": [
            {
              "status": 500,
              "when": "Storefront token not configured on Worker",
              "body": {
                "ok": false,
                "error": "Storefront not configured"
              }
            },
            {
              "status": 502,
              "when": "Upstream Fourthwall storefront request fails",
              "body": {
                "ok": false,
                "error": "Storefront unavailable"
              }
            }
          ]
        },
        "/api/contact": {
          "method": "POST",
          "purpose": "Contact form submission -> sends editor email + user receipt via Resend",
          "requires": [
            "RESEND_API_KEY",
            "FROM_EMAIL",
            "TO_EMAIL",
            "TURNSTILE_SECRET (optional)"
          ],
          "request": {
            "content_type": "application/json",
            "honeypot": [
              "website",
              "company",
              "hp"
            ],
            "fields": {
              "reason": {
                "type": "string",
                "max_len": 120,
                "required": false
              },
              "email": {
                "type": "string",
                "max_len": 320,
                "required": true,
                "format": "email"
              },
              "message": {
                "type": "string",
                "max_len": 6000,
                "required": true
              },
              "turnstileToken": {
                "type": "string",
                "required": false
              }
            }
          },
          "response": {
            "success": {
              "status": 200,
              "body": {
                "ok": true,
                "id": "CONTACT-<ts>-<rand>"
              }
            }
          },
          "errors": [
            {
              "status": 400,
              "when": "Invalid JSON or missing fields",
              "body": {
                "ok": false,
                "error": "Invalid JSON|Missing fields"
              }
            },
            {
              "status": 403,
              "when": "Turnstile verification fails when TURNSTILE_SECRET is configured",
              "body": {
                "ok": false,
                "error": "Turnstile verification failed"
              }
            },
            {
              "status": 429,
              "when": "Per-IP per-route POST rate limit exceeded",
              "body": {
                "ok": false,
                "error": "Too many requests"
              }
            },
            {
              "status": 500,
              "when": "Worker misconfigured or unexpected runtime failure",
              "body": {
                "ok": false,
                "error": "Server not configured|Internal server error"
              }
            }
          ]
        },
        "/api/submit": {
          "method": "POST",
          "purpose": "Submission inquiry -> sends editor email + user receipt via Resend",
          "requires": [
            "RESEND_API_KEY",
            "FROM_EMAIL",
            "TO_EMAIL",
            "TURNSTILE_SECRET (optional)"
          ],
          "request": {
            "content_type": "application/json",
            "honeypot": [
              "website",
              "company",
              "hp"
            ],
            "fields": {
              "email": {
                "type": "string",
                "max_len": 320,
                "required": true,
                "format": "email"
              },
              "note": {
                "type": "string",
                "max_len": 6000,
                "required": false
              },
              "turnstileToken": {
                "type": "string",
                "required": false
              }
            }
          },
          "response": {
            "success": {
              "status": 200,
              "body": {
                "ok": true,
                "id": "SUBMIT-<ts>-<rand>"
              }
            }
          },
          "errors": [
            {
              "status": 400,
              "when": "Invalid JSON or missing fields",
              "body": {
                "ok": false,
                "error": "Invalid JSON|Missing fields"
              }
            },
            {
              "status": 403,
              "when": "Turnstile verification fails when TURNSTILE_SECRET is configured",
              "body": {
                "ok": false,
                "error": "Turnstile verification failed"
              }
            },
            {
              "status": 429,
              "when": "Per-IP per-route POST rate limit exceeded",
              "body": {
                "ok": false,
                "error": "Too many requests"
              }
            },
            {
              "status": 500,
              "when": "Worker misconfigured or unexpected runtime failure",
              "body": {
                "ok": false,
                "error": "Server not configured|Internal server error"
              }
            }
          ]
        },
        "/api/updates": {
          "method": "POST",
          "purpose": "Capture updates/signup email to D1 (no email sent)",
          "requires": [
            "DB (D1 binding)",
            "TURNSTILE_SECRET (optional)"
          ],
          "request": {
            "content_type": "application/json",
            "honeypot": [
              "website",
              "company",
              "hp"
            ],
            "fields": {
              "email": {
                "type": "string",
                "max_len": 320,
                "required": true,
                "format": "email"
              },
              "source": {
                "type": "string",
                "max_len": 80,
                "required": false
              },
              "turnstileToken": {
                "type": "string",
                "required": false
              }
            }
          },
          "response": {
            "success": {
              "status": 200,
              "body": {
                "ok": true,
                "alreadySignedUp": false
              }
            }
          },
          "errors": [
            {
              "status": 400,
              "when": "Invalid JSON or missing fields",
              "body": {
                "ok": false,
                "error": "Invalid JSON|Missing fields"
              }
            },
            {
              "status": 403,
              "when": "Turnstile verification fails when TURNSTILE_SECRET is configured",
              "body": {
                "ok": false,
                "error": "Turnstile verification failed"
              }
            },
            {
              "status": 429,
              "when": "Per-IP per-route POST rate limit exceeded",
              "body": {
                "ok": false,
                "error": "Too many requests"
              }
            },
            {
              "status": 500,
              "when": "No D1 binding is configured as DB, or unexpected runtime failure",
              "body": {
                "ok": false,
                "error": "Updates list not configured|Internal server error"
              }
            }
          ]
        }
      },
      "worker_name": "stexpedite-communications"
    }
  }
}
